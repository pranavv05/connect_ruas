generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

model User {
  id                  String               @id @default(uuid())
  email               String               @unique
  username            String               @unique
  fullName            String               @map("full_name")
  avatarUrl           String?              @map("avatar_url")
  role                String               @default("student")
  createdAt           DateTime             @default(now()) @map("created_at")
  updatedAt           DateTime             @updatedAt @map("updated_at")
  connections         Connection[]
  education           Education[]
  experience          Experience[]
  feedback            Feedback[]
  notifications       Notification[]
  profile             Profile?
  projectJoinRequests ProjectJoinRequest[]
  projectMemberships  ProjectMember[]
  projectMessages     ProjectMessage[]
  assignedTasks       Task[]
  createdProjects     Project[]            @relation("CreatedProjects")
  resumes             Resume[]
  roadmaps            Roadmap[]
  skills              Skill[]
  

  @@map("users")
}

model Profile {
  id                String   @id @default(uuid())
  userId            String   @unique @map("user_id")
  bio               String?
  location          String?
  websiteUrl        String?  @map("website_url")
  githubUrl         String?  @map("github_url")
  linkedinUrl       String?  @map("linkedin_url")
  twitterUrl        String?  @map("twitter_url")
  currentStatus     String?  @map("current_status")
  yearsOfExperience Int      @default(0) @map("years_of_experience")
  createdAt         DateTime @default(now()) @map("created_at")
  updatedAt         DateTime @updatedAt @map("updated_at")
  user              User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("profiles")
}

model Skill {
  id               String   @id @default(uuid())
  userId           String   @map("user_id")
  skillName        String   @map("skill_name")
  proficiencyLevel String?  @map("proficiency_level")
  createdAt        DateTime @default(now()) @map("created_at")
  user             User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("skills")
}

model Education {
  id              String    @id @default(uuid())
  userId          String    @map("user_id")
  institutionName String    @map("institution_name")
  degree          String?
  fieldOfStudy    String?   @map("field_of_study")
  startDate       DateTime? @map("start_date")
  endDate         DateTime? @map("end_date")
  isCurrent       Boolean   @default(false) @map("is_current")
  description     String?
  createdAt       DateTime  @default(now()) @map("created_at")
  updatedAt       DateTime  @updatedAt @map("updated_at")
  user            User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("education")
}

model Experience {
  id             String    @id @default(uuid())
  userId         String    @map("user_id")
  companyName    String    @map("company_name")
  position       String
  employmentType String?   @map("employment_type")
  startDate      DateTime? @map("start_date")
  endDate        DateTime? @map("end_date")
  isCurrent      Boolean   @default(false) @map("is_current")
  description    String?
  createdAt      DateTime  @default(now()) @map("created_at")
  updatedAt      DateTime  @updatedAt @map("updated_at")
  user           User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("experience")
}

model Roadmap {
  id          String   @id @default(uuid())
  title       String
  description String
  phases      Json
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([userId])
  @@map("roadmaps")
}



model Project {
  id              String               @id @default(uuid())
  creatorId       String               @map("creator_id")
  title           String
  description     String?
  fullDescription String?
  category        String?
  status          String               @default("planning")
  difficultyLevel String?              @map("difficulty_level")
  maxTeamSize     Int?                 @map("max_team_size")
  currentTeamSize Int                  @default(1) @map("current_team_size")
  githubUrl       String?              @map("github_url")
  demoUrl         String?              @map("demo_url")
  isRecruiting    Boolean              @default(true) @map("is_recruiting")
  createdAt       DateTime             @default(now()) @map("created_at")
  updatedAt       DateTime             @updatedAt @map("updated_at")
  dueDate         DateTime?
  files           ProjectFile[]
  joinRequests    ProjectJoinRequest[]
  members         ProjectMember[]
  messages        ProjectMessage[]
  techStack       ProjectTech[]
  tasks           Task[]
  creator         User                 @relation("CreatedProjects", fields: [creatorId], references: [id], onDelete: Cascade)

  @@index([creatorId])
  @@index([status])
  @@index([isRecruiting])
  @@map("projects")
}

model ProjectTech {
  id         String  @id @default(uuid())
  projectId  String  @map("project_id")
  technology String
  project    Project @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@index([projectId])
  @@map("project_tech")
}

model ProjectFile {
  id        String  @id @default(cuid())
  name      String
  url       String
  size      Int
  type      String
  projectId String
  project   Project @relation(fields: [projectId], references: [id])
}

model ProjectMember {
  id        String   @id @default(uuid())
  projectId String   @map("project_id")
  userId    String   @map("user_id")
  role      String?
  joinedAt  DateTime @default(now()) @map("joined_at")
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  project   Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@unique([projectId, userId])
  @@index([projectId])
  @@index([userId])
  @@map("project_members")
}

model ProjectJoinRequest {
  id        String   @id @default(uuid())
  projectId String   @map("project_id")
  userId    String   @map("user_id")
  message   String?
  status    String   @default("pending")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  project   Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@unique([projectId, userId])
  @@index([projectId])
  @@index([userId])
  @@index([status])
  @@map("project_join_requests")
}

model Feedback {
  id           String   @id @default(uuid())
  userId       String?  @map("user_id")
  feedbackType String   @map("feedback_type")
  rating       Int?
  message      String
  email        String?
  status       String   @default("new")
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")
  user         User?    @relation(fields: [userId], references: [id])

  @@index([userId])
  @@index([status])
  @@map("feedback")
}

model Resume {
  id           String   @id @default(uuid())
  userId       String   @map("user_id")
  templateName String?  @map("template_name")
  content      Json?
  isActive     Boolean  @default(true) @map("is_active")
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("resumes")
}

model Notification {
  id        String   @id @default(uuid())
  userId    String   @map("user_id")
  type      String
  title     String
  message   String?
  link      String?
  isRead    Boolean  @default(false) @map("is_read")
  createdAt DateTime @default(now()) @map("created_at")
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([isRead])
  @@map("notifications")
}

model ProjectMessage {
  id        String   @id @default(uuid())
  projectId String   @map("project_id")
  userId    String   @map("user_id")
  message   String
  type      String   @default("text")
  fileName  String?  @map("file_name")
  fileSize  String?  @map("file_size")
  createdAt DateTime @default(now()) @map("created_at")
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  project   Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@index([projectId])
  @@index([userId])
  @@map("project_messages")
}

model Task {
  id          String   @id @default(uuid())
  projectId   String   @map("project_id")
  title       String
  description String?
  status      String   @default("todo") // todo, inProgress, done
  assigneeId  String?  @map("assignee_id")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")
  project     Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)
  assignee    User?    @relation(fields: [assigneeId], references: [id])

  @@index([projectId])
  @@index([assigneeId])
  @@map("tasks")
}

model Connection {
  id               String   @id @default(uuid())
  userId           String   @map("user_id")
  platform         String
  platformUsername String   @map("platform_username")
  profileUrl       String?  @map("profile_url")
  isVerified       Boolean  @default(false) @map("is_verified")
  connectedAt      DateTime @default(now()) @map("connected_at")
  user             User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, platform])
  @@index([userId])
  @@map("connections")
}
